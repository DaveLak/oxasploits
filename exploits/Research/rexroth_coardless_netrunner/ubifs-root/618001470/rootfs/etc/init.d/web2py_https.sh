#!/bin/sh
IPADDR=0.0.0.0
export CONFIG_PATH=/home/tool/config
export WEB2PY=/home/tool/web2py
export FACTORY_CONFIG_PATH=/home/tool/config/default
loggerName=web2py.sh

cat /proc/cmdline | grep '/dev/nfs' &> /dev/null
# remount readonly Behandlung nur wenn kein nfs Boot!
if [ "$?" -ne "0" ]; then
  logger -s -t $loggerName "check softlinks for remount readonly"
  #mount -o remount,rw,sync /
  python -c "import startweb2py; startweb2py.prepare_for_web2py_start()"
  logger -s -t $loggerName "remount readonly after linking in directories for web2py"
  #mount -o remount,ro /
fi

cd /home/tool/web2py/
/usr/bin/python web2py.py -a '<recycle>' -i 0.0.0.0 -p 443 -l /tmp/httpserver.log -d /tmp/httpserver.pid -c server.crt -k server.key --nogui &> /var/log/web2py.log &
echo "web2py script finished"

