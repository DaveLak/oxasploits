/*global Ext: false, document: false, window: false, BS350: false */
Ext.define('BS350.controller.ScreenshotCtrl', {
  extend: 'BS350.custom.ViewController',

  views: ['ScreenshotView'],

  items: [
    {name: 'btnUpdate', query: '#btnUpdate', actions: {click: 'updateScreenshot'}},
    {name: 'btnSave', query: '#btnSave', actions: {click: 'saveScreenshot'}}
  ],

  initView: function () {
    //CR10224
    this.updateScreenshot (this.V.btnUpdate);
  },

  updateScreenshot: function (button) {
    button.setDisabled(true);
    Ext.Ajax.request({
      url: '/BS350/ctrl/screenshot',
      success: function (res) {
        document.getElementById('screenshot-viewer').src = 'static/tmp/screenshot.png?' + (new Date()).getTime();
        button.setDisabled(false);
      }
    });
  },

  saveScreenshot: function () {
    window.location.href = 'BS350/fs/download?f=applications%2FBS350%2Fstatic%2Ftmp%2Fscreenshot.png';
  }
});

