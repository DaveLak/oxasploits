<html>
<head>
    <meta charset="UTF-8">
    <title>Actual Values</title>
    <link rel="stylesheet" type="text/css" href="../../static/ext-4.2/resources/css/nexo.css?mm={{=mediaVersion}}">
    <link rel="stylesheet" type="text/css" href="../../static/app/BS350.css?mm={{=mediaVersion}}">
    <link rel="shortcut icon" href="static/favicon.ico?mm={{=mediaVersion}}" />
    <script type="text/javascript" src="/BS350/language.js?l={{=lang}}"></script>
    <script type="text/javascript">
        var PERMDATA = {};
        var mediaVersion = "{{=mediaVersion}}";
    </script>
    <script type="text/javascript" src="../../static/BS350.js?mm={{=mediaVersion}}"></script>
    <style type="text/css">
    </style>
    <script type="text/javascript">
        Ext.Loader.setConfig({enabled: true, paths: { 'BS350': 'static/app' } });

        Ext.require('BS350.custom.Torque');
        Ext.require('BS350.custom.Utils');
        var utils = Ext.create('BS350.custom.Utils');
        Ext.getClass(utils).initEnv();

        Ext.require('BS350.custom.Analysis');

        //var mediaVersion = "mm009";

        if (typeof TR_DATA == "undefined")
            TR_DATA = {};

        TR = function(text) {var ret = TR_DATA[text]; return ret ? ret : text;};
        var APP;
        Ext.application({
            name: 'BS350',
            appFolder: '../../static/app',
            controllers: ['ActualValuesCtrl'],

            launch: function() {
                APP = this;
                var v = Ext.create('Ext.container.Viewport', {
                    layout: 'fit',
                    items: [{
                        xtype: 'actualvaluesview'}
                    ]
                });

                this.getController('ActualValuesCtrl').attachView(v.items.first());
                this.offlineMsg = Ext.create('BS350.view.OfflineWindowView');
                this.updateStatus();
            },
            updateStatus: function() {
                var me = this;
                Ext.Ajax.request({
                    url: '/BS350/status/noauthstatus',
                    timeout: 3000,
                    success: function(response) {
                        var res = {};
                        if (response.responseText !== "None") {
                            res = Ext.JSON.decode(response.responseText);
                        }
                        setTimeout(function() {me.updateStatus();}, 2000);
                        me.offlineMsg.hide();
                        var actualvalues = me.getController('ActualValuesCtrl');
                        actualvalues.actualValuesUrl = '/BS350/resultnoauth/actualvalues';
                        actualvalues.updateValues(res['cycle']);
                    },
                    failure: function(response, opts) {
                        me.offlineMsg.show();
                        setTimeout(function() {me.updateStatus();}, 2000);
                    }
                });
            }
        });
    </script>
</head>
<body>
<noscript><img src="static/images/warning.png" alt="Javascript not enabled" /><big>Javascript not enabled. Please enable it to use the application.</big></noscript>
</body>
</html>
