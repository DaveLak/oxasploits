/**
 * Created by frank on 9/15/15.
 */
Ext.define('BS350.controller.ResetToFactoryCtrl', {
  extend: 'BS350.custom.ViewController',

  views: ["ResetToFactoryView"],
  init: function () {
  },
  initView: function () {
    var me = this;
    if (this.access != 'w') {
      this.view.down('#btnSave').setVisible(false);
    } else {
      this.view.down('#btnSave').setDisabled(false);
      this.view.down('#btnSave').on('click', this.resetToFactory, me);
    }
  },
  resetToFactory: function () {
    var me = this;
    Ext.Msg.confirm(
      TR("Reset to Factory"),
      TR("All configurations are overwritten and the device will be booted. The operation can not be cancelled after this point."),
      function (answer) {
        if (answer === "yes") {
          me.view.getEl().mask(TR("Reset device to factory..."));
          Ext.Ajax.request({
            url: "/BS350/default/reset_to_factory",
            success: function () {
              me.view.getEl().unmask();
            },
            failure: function () {
              me.view.getEl().unmask();
              Ext.MessageBox.alert(TR("Failure"), TR("Something went wrong. Check your installation after reboot."));
            }
          });
        }
      }
    );

  }

});
