__author__ = 'frank'


class MasterjobDefaultTmpl:

    def __init__(self):
        self.data = []

    def create(self, user, comment, date, display_time):
        self.data.append('c = require "constants"')
        self.data.append('f = require "runFunctions"')
        self.data.append('plc = require "plcsignals"')
        self.data.append('codes = require "scancodes"')
        self.data.append('')
        self.data.append('local initNode = {')
        self.data.append('   name = "initNode",')
        self.data.append('   timeout = 300,')
        self.data.append('   type = c.TypeIdleStartNode,')
        self.data.append('   selectsCw = 0,')
        self.data.append('   selectsEn = 0,')
        self.data.append('   displayJobSteps = 1,')
        self.data.append('   displayTime = %s,' % display_time)
        self.data.append('   clearIDCode = 0,')
        self.data.append('   ignoreResults = 0,')
        self.data.append('   jobComment = \'%s\',' % comment)
        self.data.append('   jobUser = \'%s\',' % user)
        self.data.append('   jobDate = %d' % date)
        self.data.append('}')
        self.data.append('')
        self.data.append('-- Atoms for Idle Script ---')
        self.data.append('atoms  = {}')
        self.data.append('')
        self.data.append('-- Lokaler Knoten --')
        self.data.append('atoms["$Local"] = {')
        self.data.append('   type = c.TypeDevice, ')
        self.data.append('   mode = c.DeviceModeLocal,')
        self.data.append('   dest = "0"')
        self.data.append('}')
        self.data.append('')
        self.data.append('atoms["$EnableUNDO"] = {')
        self.data.append('   type = c.TypeTriggerOut,')
        self.data.append('   mode = c.TriggerOutModeBmsIn,')
        self.data.append('   dest  = plc.In.En,')
        self.data.append('   state = 0,')
        self.data.append('   range = 0,')
        self.data.append('   valueList = {}')
        self.data.append('}')
        self.data.append('')
        self.data.append('atoms["$ClockUNDO"] = {')
        self.data.append('   type = c.TypeTriggerOut,')
        self.data.append('   mode = c.TriggerOutModeBmsIn,')
        self.data.append('   dest  = plc.In.Cw,')
        self.data.append('   state = 0,')
        self.data.append('   range = 0,')
        self.data.append('   valueList = {}')
        self.data.append('}')
        self.data.append('')
        self.data.append('atoms["Job     Enabled"] = {')
        self.data.append('   type = c.TypeTriggerIn,		-- TriggerIn --')
        self.data.append('   mode = c.TriggerInModeCwJob, 	-- Warten auf Job Cw --')
        self.data.append('   dest = 0,')
        self.data.append('   state = 0,')
        self.data.append('   range = 0')
        self.data.append('}')
        self.data.append('')
        self.data.append('f.publishAtoms(atoms,function (a) cpp.job:addAtom(a) end)')
        self.data.append('')
        self.data.append('nodes = {}')
        self.data.append('nodes[1] = {}')
        self.data.append('nodes[2] = {}')
        self.data.append('nodes[3] = {}')
        self.data.append('nodes[4] = {}')
        self.data.append('nodes[5] = {}')
        self.data.append('nodes[6] = {}')
        self.data.append('nodes[7] = {}')
        self.data.append('')
        self.data.append('nodes[11] = {}')
        self.data.append('nodes[12] = {}')
        self.data.append('nodes[13] = {}')
        self.data.append('nodes[14] = {}')
        self.data.append('nodes[15] = {}')
        self.data.append('')
        self.data.append('------------ CS/SE System ------- Channel Signals -------------------------')
        self.data.append('nodes[1].atom = atoms["$Local"]')
        self.data.append('nodes[1].successor = {{var = "dummy",val = nil, next = nodes[2] }}')
        self.data.append('')
        self.data.append('nodes[2].atom = atoms["$EnableUNDO"]')
        self.data.append('nodes[2].successor = {{var = "dummy",val = nil, next = nodes[3] }}')
        self.data.append('')
        self.data.append('nodes[3].atom = atoms["$ClockUNDO"]')
        self.data.append('nodes[3].successor = {{var = "dummy",val = nil, next = nodes[4] }}')
        self.data.append('')
        self.data.append('nodes[4].atom = atoms["Job     Enabled"]')
        self.data.append('nodes[4].successor = {{var = "dummy",val = nil, next = f.EndNode }}')
        self.data.append('------------ CS/SE System ------- END -------------------------------------')
        self.data.append('')
        self.data.append('')
        self.data.append('--Eigentlicher Start Code--')
        self.data.append('f.setInitNode(initNode)')
        self.data.append('f.checkPlausib(nodes)')
        self.data.append('if( BMS == "FO" ) then')
        self.data.append('	f.go(nodes[11])')
        self.data.append('else')
        self.data.append('	f.go(nodes[2])')
        self.data.append('end')
        self.data.append('f.cleanUpNodes(atoms, nodes)')
        self.data.append('package.loaded["atoms"]=nil')

        return self.data
