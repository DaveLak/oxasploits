import json
import os
import shutil
import WGDBus
import Activity
import fsio
import FilePaths
import logConfig
import notify_activity
import status_mod




if False:
  response = None
  request = None
  session = None
  db = None

status_mod.sessionUserMgr.setLastVisit(session, request)
if logConfig.scannerSessFrgt:
  session.forget(response)



@auth.requires(request.ajax==True, requires_login=True)
def processCfg():
    scandata = None
    if request.env.request_method == "GET":
        data = fsio.jsonload(FilePaths.SCANNER_FILENAME)
        return response.json(data)

    if request.env.request_method == "POST":
        data = json.loads(request.body.read())
        fsio.jsondump(FilePaths.SCANNER_FILENAME, data)
        notify_activity.configChanged(FilePaths.SCANNER_FILENAME, Activity.SCANNER_CHANGED, session=session)
        return response.json(data)


@auth.requires(request.ajax==True, requires_login=True)
def active():
    scan = fsio.jsonload(FilePaths.SCANNER_FILENAME)
    is_active = scan.get('active')
    return response.json(is_active)


@auth.requires(request.ajax==True, requires_login=True)
def resetToFactory():
    fsio.shcopyfile(FilePaths.SCANNER_DEFAULT_FILENAME, FilePaths.SCANNER_FILENAME)
    notify_activity.configChanged(FilePaths.SCANNER_FILENAME, Activity.SCANNER_CHANGED, session=session)
    return ''

