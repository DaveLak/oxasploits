/*global Ext: false, TR: false */
Ext.define('BS350.controller.ServerErrorsCtrl', {
  extend: 'BS350.custom.ViewController',

  views: ['ServerErrorsView'],
  //stores: ['LogMessagesStore'],

  items: [
    {name: 'seGrid', query: '#seGrid'},
    {name: 'btnDetail', query: '#btnDetail', actions: {click: 'showDetail'}},
    {name: 'btnUpdate', query: '#btnUpdate', actions: {click: 'updateList'}},
    {name: 'btnClear', query: '#btnClear', actions: {click: 'clearAll'}}
  ],

  initView: function () {
    this.updateList();
    if (this.access !== 'w') {
      this.V.btnClear.hide();
    }
  },

  showDetail: function () {
    var sel = this.V.seGrid.getSelectionModel().selected;
    if (sel.getCount() > 0) {
      var item = sel.getAt(0);
      var traceback = item.get('traceback');
      var msg = traceback.replace(/\n/g, '<br>');
      Ext.Msg.show({
        title: TR('Detail'),
        value: traceback,
        multiline: true,
        width: 900,
        height: 600,
        buttons: Ext.Msg.OK,
        icon: Ext.Msg.INFO
      });
    }
  },

  updateList : function () {
    this.V.seGrid.getStore().load();
  },

  clearAll: function () {
    var me = this;
    Ext.Ajax.request({
      url: '/BS350/diagnosis/deleteServerErrors',
      success: function (response) {
        me.updateList();
      },
      failure: function (response, opts) {
        // IE can not handle this. Use only for debugging purposes:
        // konsole.log('error deleting files');
      }
    });
  }
});

